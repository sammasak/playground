---
import { witCode, pythonExample } from '../assets/string-constants.js';

// Chess Board Component with Bot Support
// Ensure base URL ends with a slash for proper path concatenation
const rawBase = import.meta.env.BASE_URL || '/';
const base = rawBase.endsWith('/') ? rawBase : rawBase + '/';
---

<div id="chess-container" data-base={base}>
  <!-- Skip to main content link -->
  <a href="#chess-board" class="skip-link">Skip to chess board</a>

  <div id="game-info" role="status" aria-live="polite">
    <div id="turn-indicator" aria-label="Current turn">White to move</div>
    <div id="game-status" aria-live="assertive" aria-atomic="true"></div>
    <div id="move-announcer" class="visually-hidden" role="status" aria-live="assertive" aria-atomic="true"></div>
  </div>

  <!-- Hidden hint for screen readers about legal moves -->
  <div id="legal-move-hint" class="visually-hidden">This is a legal move destination</div>

  <div id="main-content">
    <div id="board-column">
      <div id="board-section">
        <!-- Black player bar (plays from top) -->
        <div class="player-bar player-bar-black">
          <label for="black-player" class="player-label">Black:</label>
          <select id="black-player" aria-label="Black player type">
            <option value="human">Human</option>
            <option value="random-bot">Random Bot (Rust)</option>
            <option value="smart-bot">Smart Bot (Rust)</option>
            <option value="python-smart-bot">Smart Bot (Python)</option>
            <option value="python-bot">Python Editor Bot</option>
            <option value="upload">Upload Bot...</option>
          </select>
          <div id="black-bot-mode" class="bot-mode" role="radiogroup" aria-label="Black bot mode" style="display: none;">
            <label><input type="radio" name="black-mode" value="auto" aria-label="Auto-play mode for black"> Auto-play</label>
            <label><input type="radio" name="black-mode" value="suggest" checked aria-label="Suggest mode for black"> Suggest</label>
          </div>
        </div>

        <!-- Board with coordinate labels -->
        <div id="board-with-coords">
          <div id="rank-labels" aria-hidden="true">
            <span>8</span><span>7</span><span>6</span><span>5</span><span>4</span><span>3</span><span>2</span><span>1</span>
          </div>
          <div id="chess-board" role="grid" aria-label="Chess board. Use arrow keys to navigate, Enter or Space to select a piece or make a move, Escape to cancel selection"></div>
          <div id="file-labels-spacer" aria-hidden="true"></div>
          <div id="file-labels" aria-hidden="true">
            <span>a</span><span>b</span><span>c</span><span>d</span><span>e</span><span>f</span><span>g</span><span>h</span>
          </div>
        </div>

        <!-- White player bar (plays from bottom) -->
        <div class="player-bar player-bar-white">
          <label for="white-player" class="player-label">White:</label>
          <select id="white-player" aria-label="White player type">
            <option value="human">Human</option>
            <option value="random-bot">Random Bot (Rust)</option>
            <option value="smart-bot">Smart Bot (Rust)</option>
            <option value="python-smart-bot">Smart Bot (Python)</option>
            <option value="python-bot">Python Editor Bot</option>
            <option value="upload">Upload Bot...</option>
          </select>
          <div id="white-bot-mode" class="bot-mode" role="radiogroup" aria-label="White bot mode" style="display: none;">
            <label><input type="radio" name="white-mode" value="auto" aria-label="Auto-play mode for white"> Auto-play</label>
            <label><input type="radio" name="white-mode" value="suggest" checked aria-label="Suggest mode for white"> Suggest</label>
          </div>
        </div>

        <div id="controls">
          <button id="reset-btn" class="btn-danger" aria-label="Start a new game" title="Reset the board and start a new game"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" style="vertical-align: -2px; margin-right: 4px;" aria-hidden="true"><polyline points="1 4 1 10 7 10"></polyline><path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"></path></svg>New Game</button>
          <button id="undo-btn" class="btn-secondary" disabled aria-label="Undo last move" title="Undo the last move"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" style="vertical-align: -2px; margin-right: 4px;" aria-hidden="true"><polyline points="9 14 4 9 9 4"></polyline><path d="M20 20v-7a4 4 0 0 0-4-4H4"></path></svg>Undo</button>
          <button id="keyboard-help-btn" class="btn-secondary" aria-label="Show keyboard shortcuts" title="Show keyboard shortcuts"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" style="vertical-align: -2px; margin-right: 4px;" aria-hidden="true"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>Help</button>
        </div>
      </div>

      <!-- Game controls (relocated from Controls tab) -->
      <div id="game-controls">
        <h2 class="visually-hidden">Bot Controls</h2>
        <div id="bot-vs-bot-controls" style="display: none;">
          <h3 class="visually-hidden">Bot Match Controls</h3>
          <button id="start-match" aria-label="Start bot vs bot match" title="Start automated bot vs bot match"><svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor" stroke="none" style="vertical-align: -2px; margin-right: 4px;" aria-hidden="true"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>Start Bot Match</button>
          <button id="pause-match" class="btn-secondary" disabled aria-label="Pause bot match" title="Pause the automated bot match"><svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor" stroke="none" style="vertical-align: -2px; margin-right: 4px;" aria-hidden="true"><rect x="6" y="4" width="4" height="16"></rect><rect x="14" y="4" width="4" height="16"></rect></svg>Pause</button>
          <label for="match-speed">
            Speed: <input type="range" id="match-speed" min="100" max="2000" value="500" aria-valuemin="100" aria-valuemax="2000" aria-valuenow="500" aria-valuetext="500 milliseconds">
            <span id="speed-label" aria-live="polite">500ms</span>
          </label>
        </div>

        <div id="suggested-move" style="display: none;" role="region" aria-label="Bot suggestion">
          <strong>Suggested move:</strong> <span id="suggestion"></span>
          <button id="play-suggestion" class="btn-success" aria-label="Play the suggested move" title="Execute the bot's suggested move"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" style="vertical-align: -2px; margin-right: 4px;" aria-hidden="true"><polyline points="20 6 9 17 4 12"></polyline></svg>Play it</button>
        </div>

        <div id="bot-log">
          <h3>Bot Log</h3>
          <div id="log-content" role="log" aria-live="polite" aria-atomic="false">
            <div class="empty-state">
              <svg class="empty-state-icon" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                <defs>
                  <linearGradient id="empty-state-bot-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                    <stop offset="0%" style="stop-color:#6f42c1;stop-opacity:1" />
                    <stop offset="100%" style="stop-color:#3498db;stop-opacity:1" />
                  </linearGradient>
                </defs>
                <rect x="3" y="11" width="18" height="11" rx="2" ry="2" stroke="url(#empty-state-bot-gradient)"></rect>
                <path d="M7 11V7a5 5 0 0 1 10 0v4" stroke="url(#empty-state-bot-gradient)"></path>
                <circle cx="9" cy="16" r="1" fill="url(#empty-state-bot-gradient)"></circle>
                <circle cx="15" cy="16" r="1" fill="url(#empty-state-bot-gradient)"></circle>
              </svg>
              <p class="empty-state-title">No bot activity yet</p>
              <p class="empty-state-hint">Select a bot from the dropdowns above to see logs</p>
            </div>
          </div>
        </div>
      </div>

      <div id="move-history">
        <h2 class="visually-hidden">Game Information</h2>
        <h3>Move History</h3>
        <div id="moves-list" role="log" aria-live="polite" aria-atomic="false">
          <div class="empty-state">
            <svg class="empty-state-icon" width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
              <defs>
                <linearGradient id="empty-state-chess-gradient" x1="0%" y1="0%" x2="100%" y2="100%">
                  <stop offset="0%" style="stop-color:#6f42c1;stop-opacity:1" />
                  <stop offset="100%" style="stop-color:#3498db;stop-opacity:1" />
                </linearGradient>
              </defs>
              <rect x="3" y="3" width="18" height="18" rx="2" ry="2" stroke="url(#empty-state-chess-gradient)"></rect>
              <line x1="3" y1="7.5" x2="21" y2="7.5" stroke="url(#empty-state-chess-gradient)"></line>
              <line x1="3" y1="12" x2="21" y2="12" stroke="url(#empty-state-chess-gradient)"></line>
              <line x1="3" y1="16.5" x2="21" y2="16.5" stroke="url(#empty-state-chess-gradient)"></line>
              <line x1="7.5" y1="3" x2="7.5" y2="21" stroke="url(#empty-state-chess-gradient)"></line>
              <line x1="12" y1="3" x2="12" y2="21" stroke="url(#empty-state-chess-gradient)"></line>
              <line x1="16.5" y1="3" x2="16.5" y2="21" stroke="url(#empty-state-chess-gradient)"></line>
            </svg>
            <p class="empty-state-title">No moves recorded</p>
            <p class="empty-state-hint">Click on a piece to make your first move</p>
          </div>
        </div>
      </div>
    </div>

    <div id="side-panel">
      <div id="tab-bar" role="tablist" aria-label="Bot configuration tabs">
        <button class="tab active" data-tab="wit-tab" role="tab" aria-selected="true" aria-controls="wit-tab" id="tab-btn-wit">Bot Interface</button>
        <button class="tab" data-tab="editor-tab" role="tab" aria-selected="false" aria-controls="editor-tab" id="tab-btn-editor">Python Editor</button>
      </div>

      <div id="tab-content">
        <!-- WIT Interface Tab -->
        <div id="wit-tab" class="tab-pane active" role="tabpanel" aria-labelledby="tab-btn-wit" tabindex="0">
          <h2 class="visually-hidden">Bot Interface</h2>
          <div class="wit-section">
            <h3>Example Bots</h3>
            <div class="bot-cards">
              <div class="bot-card">
                <div class="bot-card-header">
                  <strong>Random Bot</strong>
                  <span class="bot-lang" title="Written in Rust">
                    <svg width="18" height="18" viewBox="0 0 54 40" fill="currentColor" aria-hidden="true">
                      <!-- Official Ferris the Crab - Simplified for monochrome display -->
                      <!-- Main body shell -->
                      <ellipse cx="27" cy="24" rx="18" ry="11"/>
                      <!-- Iconic spiky hair/shell top (the most important Ferris feature!) -->
                      <circle cx="20" cy="13" r="2"/>
                      <circle cx="25" cy="11" r="2.2"/>
                      <circle cx="30" cy="10" r="2.5"/>
                      <circle cx="35" cy="11" r="2.2"/>
                      <circle cx="40" cy="13" r="2"/>
                      <!-- Left claw assembly -->
                      <ellipse cx="7" cy="17" rx="4" ry="5"/>
                      <ellipse cx="12" cy="14" rx="2.5" ry="3" transform="rotate(-20 12 14)"/>
                      <!-- Right claw assembly -->
                      <ellipse cx="47" cy="17" rx="4" ry="5"/>
                      <ellipse cx="42" cy="14" rx="2.5" ry="3" transform="rotate(20 42 14)"/>
                      <!-- Left eye (white background) -->
                      <circle cx="20" cy="22" r="3.5" fill="#fff"/>
                      <circle cx="20.5" cy="22" r="2"/>
                      <!-- Right eye (white background) -->
                      <circle cx="34" cy="22" r="3.5" fill="#fff"/>
                      <circle cx="34.5" cy="22" r="2"/>
                      <!-- Bottom legs -->
                      <rect x="16" y="32" width="3" height="6" rx="1.5"/>
                      <rect x="21" y="33" width="2.5" height="5" rx="1.2"/>
                      <rect x="30" y="33" width="2.5" height="5" rx="1.2"/>
                      <rect x="35" y="32" width="3" height="6" rx="1.5"/>
                    </svg>
                  </span>
                </div>
                <p class="bot-card-desc">Picks a random legal move.</p>
                <div class="bot-card-actions">
                  <button class="bot-load-btn" data-bot="random-bot" data-color="white" aria-label="Load Random Bot as white player" title="Load Random Bot as white player">Load White</button>
                  <button class="bot-load-btn" data-bot="random-bot" data-color="black" aria-label="Load Random Bot as black player" title="Load Random Bot as black player">Load Black</button>
                  <a href="https://github.com/sammasak/playground/tree/main/bots/random-bot" target="_blank" rel="noopener noreferrer" class="bot-source-link" aria-label="View Random Bot source code on GitHub" title="View source code on GitHub">
                    <svg width="18" height="18" viewBox="0 0 16 16" fill="currentColor" aria-hidden="true">
                      <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"/>
                    </svg>
                  </a>
                </div>
              </div>
              <div class="bot-card">
                <div class="bot-card-header">
                  <strong>Smart Bot</strong>
                  <span class="bot-lang" title="Written in Rust">
                    <svg width="18" height="18" viewBox="0 0 54 40" fill="currentColor" aria-hidden="true">
                      <!-- Official Ferris the Crab - Simplified for monochrome display -->
                      <!-- Main body shell -->
                      <ellipse cx="27" cy="24" rx="18" ry="11"/>
                      <!-- Iconic spiky hair/shell top (the most important Ferris feature!) -->
                      <circle cx="20" cy="13" r="2"/>
                      <circle cx="25" cy="11" r="2.2"/>
                      <circle cx="30" cy="10" r="2.5"/>
                      <circle cx="35" cy="11" r="2.2"/>
                      <circle cx="40" cy="13" r="2"/>
                      <!-- Left claw assembly -->
                      <ellipse cx="7" cy="17" rx="4" ry="5"/>
                      <ellipse cx="12" cy="14" rx="2.5" ry="3" transform="rotate(-20 12 14)"/>
                      <!-- Right claw assembly -->
                      <ellipse cx="47" cy="17" rx="4" ry="5"/>
                      <ellipse cx="42" cy="14" rx="2.5" ry="3" transform="rotate(20 42 14)"/>
                      <!-- Left eye (white background) -->
                      <circle cx="20" cy="22" r="3.5" fill="#fff"/>
                      <circle cx="20.5" cy="22" r="2"/>
                      <!-- Right eye (white background) -->
                      <circle cx="34" cy="22" r="3.5" fill="#fff"/>
                      <circle cx="34.5" cy="22" r="2"/>
                      <!-- Bottom legs -->
                      <rect x="16" y="32" width="3" height="6" rx="1.5"/>
                      <rect x="21" y="33" width="2.5" height="5" rx="1.2"/>
                      <rect x="30" y="33" width="2.5" height="5" rx="1.2"/>
                      <rect x="35" y="32" width="3" height="6" rx="1.5"/>
                    </svg>
                  </span>
                </div>
                <p class="bot-card-desc">Prefers captures and center control.</p>
                <div class="bot-card-actions">
                  <button class="bot-load-btn" data-bot="smart-bot" data-color="white" aria-label="Load Smart Bot (Rust) as white player" title="Load Smart Bot (Rust) as white player">Load White</button>
                  <button class="bot-load-btn" data-bot="smart-bot" data-color="black" aria-label="Load Smart Bot (Rust) as black player" title="Load Smart Bot (Rust) as black player">Load Black</button>
                  <a href="https://github.com/sammasak/playground/tree/main/bots/smart-bot" target="_blank" rel="noopener noreferrer" class="bot-source-link" aria-label="View Smart Bot (Rust) source code on GitHub" title="View source code on GitHub">
                    <svg width="18" height="18" viewBox="0 0 16 16" fill="currentColor" aria-hidden="true">
                      <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"/>
                    </svg>
                  </a>
                </div>
              </div>
              <div class="bot-card">
                <div class="bot-card-header">
                  <strong>Smart Bot</strong>
                  <span class="bot-lang bot-lang-python" title="Written in Python">
                    <svg width="18" height="18" viewBox="0 0 32 32" aria-hidden="true">
                      <path fill="#3776AB" d="M15.885 2.1c-7.1 0-6.651 3.07-6.651 3.07v3.19h6.752v.96H6.545S2 8.8 2 16.005s4.013 6.912 4.013 6.912h2.4v-3.36s-.13-4.013 3.9-4.013h6.673s3.827.06 3.827-3.702V5.8s.572-3.7-6.928-3.7zm-3.82 2.15c.666 0 1.21.545 1.21 1.21 0 .666-.544 1.21-1.21 1.21s-1.21-.544-1.21-1.21c0-.665.544-1.21 1.21-1.21z"/>
                      <path fill="#FFD43B" d="M16.115 29.9c7.1 0 6.651-3.07 6.651-3.07v-3.19h-6.751v-.96h9.441S30 23.2 30 15.995s-4.013-6.912-4.013-6.912H23.6v3.36s.13 4.013-3.9 4.013h-6.673s-3.827-.06-3.827 3.702v6.042s-.572 3.7 6.928 3.7zm3.82-2.15c-.666 0-1.21-.545-1.21-1.21 0-.666.544-1.21 1.21-1.21s1.21.544 1.21 1.21c0 .665-.544 1.21-1.21 1.21z"/>
                    </svg>
                  </span>
                </div>
                <p class="bot-card-desc">Same strategy, written in Python.</p>
                <div class="bot-card-actions">
                  <button class="bot-load-btn" data-bot="python-smart-bot" data-color="white" aria-label="Load Smart Bot (Python) as white player" title="Load Smart Bot (Python) as white player">Load White</button>
                  <button class="bot-load-btn" data-bot="python-smart-bot" data-color="black" aria-label="Load Smart Bot (Python) as black player" title="Load Smart Bot (Python) as black player">Load Black</button>
                  <a href="https://github.com/sammasak/playground/tree/main/bots/python-smart-bot" target="_blank" rel="noopener noreferrer" class="bot-source-link" aria-label="View Smart Bot (Python) source code on GitHub" title="View source code on GitHub">
                    <svg width="18" height="18" viewBox="0 0 16 16" fill="currentColor" aria-hidden="true">
                      <path d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"/>
                    </svg>
                  </a>
                </div>
              </div>
            </div>
          </div>

          <div class="wit-section">
            <h3>Upload Your Bot</h3>
            <div id="upload-dropzone" role="button" tabindex="0" aria-label="Upload bot file: Drop a .wasm bot component here or click to browse">
              <svg class="upload-icon" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="17 8 12 3 7 8"></polyline><line x1="12" y1="3" x2="12" y2="15"></line></svg>
              <p>Drop a <code>.wasm</code> bot component here<br>or click to browse</p>
              <p class="upload-note">Must implement <code>chess:bot@0.1.0</code></p>
            </div>
            <div id="upload-status" style="display: none;" role="status" aria-live="polite"></div>
          </div>

          <div class="wit-section">
            <details>
              <summary class="wit-summary">WIT Reference</summary>
              <p class="wit-desc">Bots receive the full board state (with move history) and legal moves, then return a UCI move string.</p>
              <pre id="wit-code" class="code-block" role="region" aria-label="WIT interface code example">{witCode}</pre>
            </details>
          </div>

          <div class="wit-section">
            <button class="tab-link" data-tab="editor-tab" aria-label="Switch to Python Editor tab">Open Python Editor →</button>
          </div>
        </div>

        <!-- Python Editor Tab -->
        <div id="editor-tab" class="tab-pane" style="display: none;" role="tabpanel" aria-labelledby="tab-btn-editor" tabindex="0">
          <h2 class="visually-hidden">Python Bot Editor</h2>
          <div class="editor-header">
            <h3>Python Bot Playground</h3>
            <p class="editor-desc">Implement the WIT bot interface as Python functions. Host functions are globals.</p>
            <p class="editor-desc"><em>Powered by <a href="https://github.com/pydantic/monty" target="_blank" rel="noopener noreferrer">Monty</a> — secure Python subset in WASM</em></p>
          </div>
          <div id="python-code-editor" data-initial-code={pythonExample} role="region" aria-label="Python code editor"></div>
          <div class="editor-actions">
            <button id="test-python" class="btn-success" aria-label="Test Python bot code" title="Test your Python bot code for errors"><svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor" stroke="none" style="vertical-align: -2px; margin-right: 4px;" aria-hidden="true"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>Test Code</button>
            <button id="apply-python" aria-label="Apply Python bot to game" title="Apply this Python bot to the game"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round" style="vertical-align: -2px; margin-right: 4px;" aria-hidden="true"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path><polyline points="17 8 12 3 7 8"></polyline><line x1="12" y1="3" x2="12" y2="15"></line></svg>Apply to Bot</button>
          </div>
          <div id="python-feedback" style="display: none;" role="alert" aria-live="assertive"></div>
        </div>
      </div>
    </div>
  </div>

  <input type="file" id="bot-upload" accept=".wasm,.js" style="display: none;" aria-label="Select bot file to upload">

  <!-- Keyboard shortcuts help modal -->
  <div id="keyboard-help-modal" class="promotion-modal" style="display: none;" role="dialog" aria-labelledby="keyboard-help-title" aria-modal="true">
    <div class="keyboard-help-content">
      <h2 id="keyboard-help-title">Keyboard Shortcuts</h2>
      <button id="close-keyboard-help" class="close-modal-btn" aria-label="Close keyboard shortcuts help">✕</button>
      <div class="keyboard-shortcuts-list">
        <h3>Chess Board Navigation</h3>
        <dl>
          <dt><kbd>Arrow Keys</kbd></dt>
          <dd>Navigate between squares on the chess board</dd>
          <dt><kbd>Enter</kbd> or <kbd>Space</kbd></dt>
          <dd>Select a piece or make a move</dd>
          <dt><kbd>Escape</kbd></dt>
          <dd>Cancel current selection</dd>
        </dl>
        <h3>Tab Navigation</h3>
        <dl>
          <dt><kbd>Tab</kbd></dt>
          <dd>Move to next interactive element</dd>
          <dt><kbd>Shift + Tab</kbd></dt>
          <dd>Move to previous interactive element</dd>
        </dl>
        <h3>Python Editor</h3>
        <dl>
          <dt><kbd>Ctrl + S</kbd> or <kbd>Cmd + S</kbd></dt>
          <dd>Apply Python code to bot</dd>
          <dt><kbd>Ctrl + Enter</kbd> or <kbd>Cmd + Enter</kbd></dt>
          <dd>Test Python code</dd>
        </dl>
      </div>
      <button id="close-keyboard-help-btn" class="btn-primary">Got it!</button>
    </div>
  </div>
</div>

<style is:global>
  @import '../assets/chess-board.css';
  @import '../assets/button-enhancements.css';
  @import '../assets/board-interaction-enhancements.css';
  @import '../assets/accessibility-enhancements.css';
</style>

<script>
  import '../scripts/chess-game.js';
</script>
